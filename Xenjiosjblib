Modified lib (Beautified and optimized by ChatGPT 3.5)
